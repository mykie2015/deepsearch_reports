# Best Practices for Android Mobile App Startup Profiling

## 1. Introduction

Startup performance is critical for a positive user experience in Android applications.  A slow startup can lead to user frustration, app abandonment, and negative reviews.  Profiling the startup process helps identify bottlenecks and areas for optimization, ultimately leading to a faster, more responsive app.  This report outlines best practices for profiling Android app startup, covering key metrics, profiling strategies throughout the software development lifecycle (SDLC), the impact of Runtime Application Self-Protection (RASP), and integration with Continuous Integration/Continuous Delivery (CI/CD) pipelines.

## 2. Terms Explanation

*   **TTID (Time to Initial Display):** The time it takes for the app to display its first frame. This includes process initialization, activity creation, and rendering the initial UI.  A low TTID is crucial for giving the user immediate feedback that the app is launching.
*   **TTFD (Time to Full Display):** The time it takes for the app to become fully interactive. This indicates when the user can actually start using the app.
*   **Cold Start:** The app starts from scratch, with no process or data already in memory. This is the slowest startup type.
*   **Warm Start:** The app's process might still be in memory, but the activity needs to be recreated.  Faster than a cold start, but slower than a hot start.
*   **Hot Start:** The app is brought to the foreground from the background, with its activity and data already in memory. This is the fastest startup type.
*   **JIT (Just-In-Time) Compilation:**  The Android Runtime (ART) compiles bytecode into native code at runtime, as needed.
*   **AOT (Ahead-Of-Time) Compilation:**  Code is pre-compiled into native code during app installation, improving runtime performance.
*   **Baseline Profiles:**  A list of classes and methods used during app startup, pre-compiled to improve startup time and overall performance.
*   **Startup Profiles:** A part of Baseline Profiles, specifically focused on optimizing the app's startup sequence.
*   **RASP (Runtime Application Self-Protection):** A security technology that integrates with the app to detect and prevent attacks in real-time.
*   **CI/CD (Continuous Integration/Continuous Delivery):**  A set of practices that automate the software release process, from code changes to deployment.
*   **ANR (Application Not Responding):** A dialog shown to the user when the app's UI thread is blocked for too long.
*   **Perfetto:** A platform-wide tracing tool for Android, Linux, and Chrome, used for performance analysis.
*   **Instrument (打桩):** In the context of software testing and profiling, instrumentation refers to adding extra code to the application to collect data about its execution. This "extra code" is often referred to as "probes" or "桩" (zhuāng, meaning "stake" or "pile" in Chinese).

## 3. Profiling Key Metrics

### 3.1. Basic Startup Time Measurement

*   **TTID:** Use `adb shell am start` command or monitor Logcat in Android Studio for the "Displayed" metric. This provides a basic, objective measurement.
*   **TTFD:** Implement `reportFullyDrawn()` in your activity to signal when the app is fully interactive. This is more subjective and depends on your app's specific logic.
*   **Android Vitals (Google Play Console):**  Provides startup time metrics (cold, warm, hot) collected from real users.  Excessive startup times are flagged (Cold > 5s, Warm > 2s, Hot > 1.5s).
*   **Firebase Performance Monitoring:**  Offers startup time tracking with minimal configuration if you're already using Firebase.

### 3.2. Identifying CPU Bottlenecks during Startup

*   **Android Studio CPU Profiler:**  Provides detailed information about CPU usage, thread activity, and method execution times. Use "Trace Java Methods" or "Sample Java Methods" for detailed analysis.
*   **Perfetto:**  Offers system-wide tracing, including CPU frequency, scheduling activity, and task switching latency.  Useful for identifying interactions between your app and the system.
*   **Systrace:** (older tool, Perfetto is recommended) Captures system-level events, helping to identify issues like contention on the main thread.

### 3.3. Memory Allocation Analysis during Startup

*   **Android Studio Memory Profiler:**  Tracks memory allocations, identifies memory leaks, and helps analyze garbage collection events.
*   **Perfetto (heapprofd):**  Provides native memory usage information, useful for identifying memory leaks in native code.
*   **LeakCanary:** A library that helps detect memory leaks in your app during development.

### 3.4. Storage I/O

*   **Android Studio Profiler (I/O):** Analyze file I/O operations during startup.  Minimize file reads and writes on the main thread.
*   **Perfetto:** Can be configured to track file I/O activity at the system level.

### 3.5. Network and others
* Network request, consider user experience, better to show loading UI first.
* Battery consumption.

## 4. SDLC Profiling Strategy for Startup Performance

Define use case with: As XXX, I want to YYY, so that ZZZ.

Example: As a user, I want the app to load quickly, so that I can start using it without delay.

### 4.1. PR Merge Impact Analysis (Performance Gates)

*   **Use Case:** As a developer, I want to prevent performance regressions from being merged into the main branch, so that the app's startup time remains optimal.
*   **Implementation:**  Integrate startup time measurement into your CI/CD pipeline.  Run performance tests on pull requests and set thresholds for acceptable TTID/TTFD increases.  Fail the build if the thresholds are exceeded.  Use tools like Perfetto or custom scripts to measure startup time.

### 4.2. Daily Builds (Trend Monitoring)

*   **Use Case:** As a QA engineer, I want to track startup time trends over time, so that I can identify gradual performance degradations.
*   **Implementation:**  Run automated startup time tests on daily builds.  Collect and visualize the data (TTID, TTFD, CPU usage, memory allocation) in a dashboard.  Set up alerts for significant performance changes.

### 4.3. Release Builds (Pre-Release Validation)

*   **Use Case:** As a release manager, I want to ensure that the release candidate meets performance targets before it's published, so that users have a good experience.
*   **Implementation:**  Perform comprehensive startup time testing on release builds, using a variety of devices and network conditions.  Compare the results against established baselines.

### 4.4. Google Play Store (Pre-Launch - Limited)

*   **Use Case:** As a product manager, I want to gather real-world startup time data from a limited set of users before a full rollout, so that I can identify any unexpected issues.
*   **Implementation:** Use the Google Play Console's pre-launch report and internal/alpha/beta testing tracks to collect startup time data from real users.

### 4.5. Final User Device App Profile (Real User Monitoring - RUM)

*   **Use Case:** As a performance engineer, I want to continuously monitor startup time in production, so that I can identify and address issues that affect real users.
*   **Implementation:**  Integrate a RUM solution (e.g., Firebase Performance Monitoring, BugSnag, New Relic) to collect startup time data from users' devices.  Analyze the data to identify trends, outliers, and areas for improvement.

### 4.6. Centralized Dashboard for Mobile Community

* **Use Case:** As a team lead, I want a centralized view of startup performance metrics across all stages of the SDLC, so that the entire team can stay informed and collaborate on optimization efforts.
* **Implementation:** Create a dashboard that aggregates data from CI/CD, pre-launch testing, and RUM. Display key metrics, trends, and alerts.

### 4.7. Automated Pipeline Orchestration

* **Use Case:** As a DevOps engineer, I want to automate the entire startup profiling process, from triggering tests to collecting and reporting results, so that it's efficient and requires minimal manual intervention.
* **Implementation:** Use a CI/CD platform (e.g., Jenkins, GitLab CI, CircleCI, Bitrise) to orchestrate the profiling workflow. Configure triggers, build steps, and reporting integrations.

### 4.8. SDLC Profiling Strategy Summary Table

| Stage                     | Use Case                                                                                                | Tools                                                                                                | Metrics                                   | Goal                                                                                             |
| ------------------------- | ------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ----------------------------------------- | ------------------------------------------------------------------------------------------------ |
| PR Merge                  | Prevent performance regressions.                                                                        | Perfetto, custom scripts, CI/CD integration                                                          | TTID, TTFD, CPU usage, memory allocation | Prevent merging code that significantly degrades startup performance.                               |
| Daily Builds              | Track startup time trends.                                                                              | Perfetto, custom scripts, CI/CD integration, dashboard                                                | TTID, TTFD, CPU usage, memory allocation | Identify gradual performance degradations.                                                        |
| Release Builds            | Validate performance before release.                                                                    | Perfetto, Android Studio Profiler, device farm                                                       | TTID, TTFD, CPU usage, memory allocation | Ensure the release candidate meets performance targets.                                            |
| Google Play Store (Pre-Launch) | Gather real-world data from a limited audience.                                                      | Google Play Console pre-launch report, internal/alpha/beta testing tracks                             | TTID, TTFD                                | Identify unexpected issues before a full rollout.                                                 |
| User Devices (RUM)        | Continuously monitor startup time in production.                                                        | Firebase Performance Monitoring, BugSnag, New Relic, TestFairy                                       | TTID, TTFD, device/OS breakdowns          | Identify and address issues affecting real users.                                                  |
| Centralized Dashboard     | Provide a unified view of startup performance.                                                          | Custom dashboard, data visualization tools                                                           | All collected metrics                     | Facilitate team collaboration and informed decision-making.                                      |
| Automated Pipeline        | Automate the profiling process.                                                                         | Jenkins, GitLab CI, CircleCI, Bitrise, GitHub Actions                                                | N/A                                       | Improve efficiency and reduce manual effort.                                                      |

## 5. Profiling and Managing RASP Impact on Startup

### 5.1. Understanding RASP Impact

Runtime Application Self-Protection (RASP) adds a security layer that can potentially impact startup time.  RASP solutions monitor the app's runtime behavior, which introduces overhead.  The impact can vary depending on the RASP implementation and the specific security checks performed.  It's crucial to profile the app with and without RASP enabled to quantify the impact. A study by Gartner found that traditional RASP solutions average less than a 2% performance impact at scale. However, this can vary based on implementation and workload.

### 5.2. Integrating RASP Profiling into SDLC

#### 5.2.1. PR Merge Impact Analysis (with RASP)

*   **Implementation:**  Include RASP in the performance tests run on pull requests.  Measure startup time with and without RASP enabled to assess the impact of each code change.

#### 5.2.2. Daily Builds (RASP Trend Monitoring)

*   **Implementation:**  Run automated startup time tests with RASP enabled on daily builds.  Track the RASP-specific overhead over time.

#### 5.2.3. Release Builds (RASP Performance Validation)

*   **Implementation:**  Perform comprehensive startup time testing on release builds with RASP enabled.  Ensure the overhead is within acceptable limits.

#### 5.2.4. Google Play Store & User Devices (RUM with RASP)

*   **Implementation:**  If your RUM solution supports it, collect startup time data with and without RASP enabled (e.g., through A/B testing or feature flags).  This allows you to monitor the real-world impact of RASP on different devices and user segments.

### 5.3. Techniques for Profiling RASP Impact

Understanding RASP and its Impact on Startup
What is RASP?

RASP is a security technology that embeds directly within an application to protect it from runtime attacks. Unlike traditional security measures that operate at the network or perimeter level, RASP operates from inside the application itself.

How RASP Can Impact Startup Time:

RASP solutions often work by:

Instrumentation: RASP might instrument the application code to insert security checks and monitoring points. This instrumentation itself can add a small overhead during startup (and runtime).
Runtime Analysis: RASP performs real-time analysis of application behavior, looking for malicious activity or deviations from expected patterns. This analysis consumes CPU and memory resources, potentially affecting startup.
Security Policy Initialization: RASP solutions need to load and initialize security policies and rules during app startup. This initialization process adds to the startup duration.
Hooking System APIs: RASP might hook system APIs to intercept and monitor critical operations. API hooking can introduce overhead.
Encryption/Decryption: Some RASP solutions involve encryption or decryption processes during startup for code protection or integrity checks.
The Impact:  The extent of RASP's impact on startup time depends on the specific RASP solution, its configuration, and the complexity of the security policies it enforces.  It's essential to measure this impact rather than just assume it's negligible.

Integrating RASP Impact Profiling into the SDLC
Here's how to incorporate RASP impact analysis into each stage of the SDLC:

1. PR Merge Impact Analysis (with RASP):

Profiling with and without RASP: In your PR pipeline, ideally, you should profile two versions of the app:
Build with RASP Integrated: This is the version that includes your RASP solution and its security policies.
Build without RASP (or with RASP disabled for profiling): This serves as a baseline to isolate the performance overhead specifically introduced by RASP.
Performance Delta Measurement: Calculate the difference in startup metrics (e.g., startup time, phase durations, CPU usage) between the RASP-enabled build and the baseline build. This delta represents the performance cost of RASP for the code changes in the PR.
RASP Performance Thresholds: Establish separate performance thresholds specifically for the RASP overhead. For example, you might allow a certain percentage increase in startup time due to RASP, but if it exceeds this threshold, the PR check fails.
Report RASP Overhead: In the PR performance report, clearly present the RASP performance overhead metrics alongside the overall startup performance. Highlight if the RASP overhead is within acceptable limits.

*   **A/B Testing:**  Deploy two versions of the app (one with RASP, one without) to different user groups and compare startup times.
*   **Feature Flags:**  Use feature flags to enable/disable RASP dynamically and collect performance data for both configurations.
*   **Custom Instrumentation:**  Add custom logging or timing code around RASP initialization and security checks to measure their specific impact.
*   **Profiling Tools:** Use Android Studio Profiler or Perfetto to analyze CPU and memory usage with RASP enabled.

### 5.4. Key Considerations for RASP and Startup Profiling

*   **Configuration:**  RASP solutions often have configurable settings that can affect performance.  Fine-tune the settings to balance security and performance.
*   **False Positives:**  Ensure the RASP solution isn't generating false positives, which can lead to unnecessary overhead.
*   **Optimization:**  Work with the RASP vendor to optimize the integration and minimize performance impact.
*   **Sampling:** Use sampling techniques to reduce the number of requests analyzed by RASP.

Example PR Report Section (RASP Impact):

## RASP Performance Impact Analysis:

| Metric                 | Baseline (No RASP) | With RASP | Delta     | Threshold | Pass/Fail |
| ---------------------- | ------------------ | --------- | --------- | --------- | --------- |
| Cold Startup Time (ms) | 800ms              | 950ms     | +150ms    | +200ms    | Pass      |
| Application onCreate (ms) | 200ms              | 250ms     | +50ms     | +75ms     | Pass      |
| RASP Overhead (Total Startup) | N/A              | 150ms     | 150ms     | 200ms     | Pass      |
| RASP Overhead (App OnCreate) | N/A              | 50ms      | 50ms      | 75ms      | Pass      |

**Conclusion:** RASP integration adds approximately 150ms to the cold startup time. This is within the acceptable RASP overhead threshold of 200ms. Performance gate: **PASS**.

## 6. Instrument(打桩) with CI/CD
### Explaination
Instrumentation, or "打桩" (dǎzhuāng), in the context of Perfetto and CI/CD for Android app startup profiling, is not strictly mandatory to get valuable data, but it is highly recommended to get more detailed and actionable insights into what specifically contributes to your app's startup time.

### Here's a breakdown to clarify when and why instrumentation is beneficial:

Perfetto Without Instrumentation (System-Level Tracing):

What you get: Perfetto, even without adding any code to your app, is a powerful system-wide tracing tool. It can capture a wealth of information about your app's startup process at the system level, including:

* CPU usage: Breakdown of CPU usage by threads and processes, showing which parts of the system are busy during startup.
Scheduling events: Information about thread scheduling, context switching, and thread states.
* System calls: Traces of system calls made by your app and the Android framework.
* Memory allocation: Insights into memory allocation and garbage collection activity.
* Android framework events: Events from the Android framework related to activity lifecycle, view inflation, and more.
* Overall Startup Time: You can measure the total duration of the app startup process.

### Benefits for CI/CD:

Automated Regression Detection: System-level tracing can detect regressions in overall startup time and identify periods of high CPU usage or memory pressure that might indicate performance problems.
High-Level Bottleneck Identification: You can often pinpoint system-level bottlenecks, such as excessive system service calls or inefficient thread scheduling, even without app-specific instrumentation.
Easier Automation: Setting up system-level tracing in CI/CD is generally simpler as it doesn't require modifying the app's codebase.
Limitations:

Limited App-Specific Context: System-level traces alone may not directly tell you *which parts of your app's Kotlin code are slow. You see system-level activity, but it can be harder to directly correlate it to specific functions or code blocks within your app.
Less Actionable for Developers: While you can detect regressions, it might be less clear for developers where to focus their optimization efforts within the app's code.
Perfetto With Instrumentation ("打桩"):

What you get (in addition to system-level tracing): By adding instrumentation (using androidx.tracing.Trace in Kotlin or Java), you can capture custom events and time ranges directly within your app's code. This allows you to see:

Specific function execution times: Measure the duration of critical functions in your startup path.
Custom startup phases: Define and track the time spent in different phases of your app's initialization (e.g., "Application onCreate," "Activity creation," "Data loading," "UI inflation").
Custom metrics: Record custom metrics relevant to your app's startup process.
Clearer Bottleneck Identification within App Code: Instrumentation directly highlights slow parts of your app's code, making it much easier to identify and fix bottlenecks.
Benefits for CI/CD:

Precise Bottleneck Localization: Instrumentation allows your CI/CD system to pinpoint performance regressions down to specific functions or startup phases within your app's codebase.
Actionable Performance Reports: CI/CD reports can be much more actionable for developers, directly indicating which code areas need optimization.
Granular Performance Metrics: You can track trends of specific startup phases over builds, providing more detailed performance monitoring.
Considerations:

Code Modification Required: Instrumentation requires adding Trace.beginSection and Trace.endSection calls (or similar mechanisms) in your Kotlin code.
Maintenance: Instrumentation code needs to be maintained and updated as your app evolves.
Slight Performance Overhead (in debug/profileable builds): While Trace has minimal overhead in release builds, there is some overhead in debug or profileable builds where you typically collect traces.
In Summary:

Feature	Perfetto Without Instrumentation	Perfetto With Instrumentation ("打桩")
Data Collected	System-level metrics, framework events, overall startup time	System-level metrics + App-specific code execution times, custom phases, metrics
Bottleneck Identification	System-level bottlenecks, high-level app bottlenecks	Precise bottlenecks within app's Kotlin code
Actionability for Devs	Less direct, requires more investigation to link system events to app code	More direct, clearly points to slow code areas
CI/CD Automation	Easier to set up initially	Requires code changes and potentially more complex analysis scripts
Overhead	Minimal	Slightly higher in debug/profileable builds
Mandatory for CI/CD	No	No, but highly recommended for deeper insights

Export to Sheets
Recommendation for CI/CD Integration:

Start with System-Level Tracing: Begin by integrating Perfetto into your CI/CD pipeline to collect system-level traces without initial instrumentation. This is easier to set up and will give you a baseline for monitoring overall startup performance and detecting regressions.
Analyze System-Level Traces: Use the system-level traces to identify potential bottlenecks at a higher level. Look for periods of high CPU usage, long system calls, or memory issues during startup.
Introduce Instrumentation Strategically: Based on the system-level analysis, identify key areas in your app's startup code that you suspect might be bottlenecks. Add instrumentation (Trace.beginSection, Trace.endSection) around these critical code sections.
Refine Instrumentation Iteratively: Analyze traces with instrumentation. If the initial instrumentation reveals bottlenecks, you might need to add more instrumentation to drill down further and pinpoint the exact cause.
Automate Trace Analysis in CI/CD: Develop scripts to automatically parse Perfetto traces (both system-level and with instrumentation) in your CI/CD pipeline. Extract relevant metrics (startup time, phase durations, function execution times) and set up performance thresholds to detect regressions.
Use Macrobenchmark with Perfetto: For more robust and automated performance measurements, consider using Jetpack Macrobenchmark. Macrobenchmark integrates well with Perfetto and can automatically generate traces during benchmark runs, which can be easily incorporated into your CI/CD workflow.
In conclusion, while "打桩" (instrumentation) is not strictly required to use Perfetto in CI/CD for basic startup profiling and regression detection, it is highly recommended to gain deeper, more actionable insights into your app's startup performance and to effectively pinpoint and address bottlenecks within your Kotlin codebase.  Start with system-level tracing and progressively add instrumentation as needed to achieve your desired level of performance analysis in your CI/CD pipeline.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 